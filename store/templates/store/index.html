{% extends 'store/base.html' %}
{% load static %}
{% load customfunction %}

{% block headermenu %}
<div class="header-bottom">
	<div class="container-fluid">
		<div class="row">
			<div class="col-md-12">
				<div class="responsive categorymenu modern-category-nav">
					{% for p in cat %}
					<div class="cat-wrapper category-item">
						<div class="text-center category-content">
							<div class="category-icon-wrapper">
								<a href="{% url 'store:category' id=p.id %}" class="category-link">
									<img src="{{ p.icon.url }}" alt="{{ p.name }}" class="category-icon"/>
								</a>
							</div>
							<a href="{% url 'store:category' id=p.id %}" class="category-name">{{ p.name }}</a>
						</div>
					</div>
					{% endfor %}
				</div>
			</div>
		</div>
	</div>
</div>
{% endblock %}

			{% block container %}
			<div class="row">
				<!-- Hero Slider Section -->
				<!-- <div class="col-sm-12">
					<div class="hero-slider-wrapper">
						<div class="slider-container">
							<ul id="demo3" class="hero-slider">
								{% for sld in slide %}
								<li class="slide-item">
									<img src="{{ sld.slideimg.url }}" alt="Featured Book" class="hero-slide-image"/>
									<div class="slide-overlay">
										<div class="slide-content">
											<h2 class="slide-title">Discover Amazing Books</h2>
											<p class="slide-subtitle">Explore our collection of bestsellers and new releases</p>
											<a href="#new-books" class="btn btn-primary slide-cta">Shop Now</a>
										</div>
									</div>
								</li>
								{% endfor %}
							</ul>
						</div>
					</div>
				</div> -->

				<!-- New Published Books Section -->
				<div class="col-sm-12" id="new-books">
					<div class="section-wrapper">
						<div class="titleheader modern-section-header">
							<div class="section-title-wrapper">
								<h3 class="h2header section-title">
									<span class="title-icon">üìö</span>
									New Published Books
								</h3>
								<p class="section-subtitle">Discover the latest additions to our collection</p>
							</div>
							<a href="#" class="see-all-btn">
								See All <i class="fa fa-arrow-right"></i>
							</a>
						</div>
						<div class="books-grid">
							{% for item in newbooks %}
							<div class="book-card">
								<div class="book-image-wrapper">
									<div class="coverpage">
										<img src="{{ item.coverpage.url }}" alt="{{ item.name }}" class="book-cover"/>
									</div>
									<div class="book-overlay">
										<a href="{% url 'store:book' id=item.id %}" class="quick-view-btn">
											<i class="fa fa-eye"></i> Quick View
										</a>
									</div>
								</div>
								<div class="book-info">
									<a href="{% url 'store:book' id=item.id %}" class="book-title">{{ item.name|text_short }}</a>
									<a href="{% url 'store:writer' id=item.writer.id %}" class="book-author">{{ item.writer }}</a>
									<div class="rating-wrapper">
										<div class="rating">
											{{ item.totalrating|averagerating:item.totalreview }}
										</div>
										<span class="review-count">({{ item.totalreview|add:-1 }} reviews)</span>
									</div>
									<div class="price-wrapper">
										<span class="price">${{ item.price }}</span>
									</div>
									<button class="btn btn-cart add-to-cart-btn" data-book-id="{{ item.id }}">
										<i class="fa fa-shopping-cart"></i>
										<span>Add to Cart</span>
									</button>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
				</div>

				<!-- Top Selling Books Section -->
				<div class="col-sm-12">
					<div class="section-wrapper">
						<div class="titleheader modern-section-header">
							<div class="section-title-wrapper">
								<h3 class="h2header section-title">
									<span class="title-icon">üèÜ</span>
									Top Selling Books
								</h3>
								<p class="section-subtitle">Most popular books among our readers</p>
							</div>
						</div>
						<div class="books-grid">
							{% for p in newbooks %}
							<div class="book-card bestseller">
								<div class="bestseller-badge">
									<span>Bestseller</span>
								</div>
								<div class="book-image-wrapper">
									<div class="coverpage">
										<img src="{{ p.coverpage.url }}" alt="{{ p.name }}" class="book-cover"/>
									</div>
									<div class="book-overlay">
										<a href="{% url 'store:book' id=p.id %}" class="quick-view-btn">
											<i class="fa fa-eye"></i> Quick View
										</a>
									</div>
								</div>
								<div class="book-info">
									<a href="{% url 'store:book' id=p.id %}" class="book-title">{{ p.name|text_short }}</a>
									<a href="{% url 'store:writer'  id=p.writer.id %}" class="book-author">{{ p.writer }}</a>
									<div class="rating-wrapper">
										<div class="rating">
											{{ p.totalrating|averagerating:p.totalreview }}
										</div>
										<span class="review-count">({{ p.totalreview|add:-1 }} reviews)</span>
									</div>
									<div class="price-wrapper">
										<span class="price">${{ p.price }}</span>
									</div>
									<button class="btn btn-cart add-to-cart-btn" data-book-id="{{ p.id }}">
										<i class="fa fa-shopping-cart"></i>
										<span>Add to Cart</span>
									</button>
								</div>
							</div>
							{% endfor %}
						</div>
					</div>
				</div>
			</div> 
			{% endblock %}

			{% block scripts %}
			<style>
				/* Modern Category Navigation */
				.modern-category-nav {
					padding: 20px 0;
					background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				}

				.category-item {
					transition: all 0.3s ease;
					margin: 0 10px;
				}

				.category-content {
					padding: 15px;
					border-radius: 12px;
					background: rgba(255, 255, 255, 0.1);
					backdrop-filter: blur(10px);
					transition: all 0.3s ease;
				}

				.category-item:hover .category-content {
					background: rgba(255, 255, 255, 0.2);
					transform: translateY(-5px);
					box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
				}

				.category-icon-wrapper {
					margin-bottom: 10px;
				}

				.category-icon {
					width: 50px;
					height: 50px;
					border-radius: 50%;
					object-fit: cover;
					transition: all 0.3s ease;
				}

				.category-item:hover .category-icon {
					transform: scale(1.1);
				}

				.category-name {
					color: white;
					text-decoration: none;
					font-weight: 500;
					font-size: 14px;
				}

				.category-name:hover {
					color: #ffc107;
					text-decoration: none;
				}

				/* Hero Slider */
				.hero-slider-wrapper {
					margin-bottom: 60px;
				}

				.slider-container {
					position: relative;
					border-radius: 15px;
					overflow: hidden;
					box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
				}

				.hero-slider {
					list-style: none;
					padding: 0;
					margin: 0;
				}

				.slide-item {
					position: relative;
					height: 400px;
					overflow: hidden;
				}

				.hero-slide-image {
					width: 100%;
					height: 100%;
					object-fit: cover;
				}

				.slide-overlay {
					position: absolute;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: linear-gradient(45deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.3) 100%);
					display: flex;
					align-items: center;
					justify-content: center;
				}

				.slide-content {
					text-align: center;
					color: white;
					z-index: 2;
				}

				.slide-title {
					font-size: 3rem;
					font-weight: 700;
					margin-bottom: 20px;
					text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
				}

				.slide-subtitle {
					font-size: 1.2rem;
					margin-bottom: 30px;
					opacity: 0.9;
				}

				.slide-cta {
					padding: 15px 30px;
					font-size: 1.1rem;
					border-radius: 50px;
					background: linear-gradient(45deg, #ffc107, #ff9800);
					border: none;
					color: white;
					font-weight: 600;
					transition: all 0.3s ease;
					text-decoration: none;
				}

				.slide-cta:hover {
					transform: translateY(-3px);
					box-shadow: 0 10px 25px rgba(255, 193, 7, 0.4);
					color: white;
					text-decoration: none;
				}

				/* Section Styling */
				.section-wrapper {
					margin-bottom: 60px;
				}

				.modern-section-header {
					display: flex;
					justify-content: space-between;
					align-items: center;
					margin-bottom: 40px;
					padding-bottom: 20px;
					border-bottom: 2px solid #f8f9fa;
				}

				.section-title-wrapper {
					flex: 1;
				}

				.section-title {
					font-size: 2.8rem;
					font-weight: 800;
					background: linear-gradient(135deg, #2c3e50 0%, #667eea 50%, #764ba2 100%);
					-webkit-background-clip: text;
					-webkit-text-fill-color: transparent;
					background-clip: text;
					margin: 0;
					display: flex;
					align-items: center;
					gap: 15px;
					text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
					position: relative;
					z-index: 2;
				}

				.section-title::before {
					content: '';
					position: absolute;
					top: 50%;
					left: -20px;
					width: 6px;
					height: 60px;
					background: linear-gradient(135deg, #667eea, #764ba2);
					border-radius: 3px;
					transform: translateY(-50%);
					box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
				}

				.title-icon {
					font-size: 2.5rem;
					background: linear-gradient(135deg, #ffc107, #ff9800);
					-webkit-background-clip: text;
					-webkit-text-fill-color: transparent;
					background-clip: text;
					filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.2));
					transition: all 0.3s ease;
				}

				.title-icon:hover {
					transform: scale(1.1) rotate(10deg);
					filter: drop-shadow(3px 3px 8px rgba(255, 193, 7, 0.4));
				}

				.section-subtitle {
					color: #6c757d;
					font-size: 1.1rem;
					margin: 10px 0 0 0;
				}

				.see-all-btn {
					background: linear-gradient(45deg, #667eea, #764ba2);
					color: white;
					padding: 12px 25px;
					border-radius: 25px;
					text-decoration: none;
					font-weight: 500;
					transition: all 0.3s ease;
					display: flex;
					align-items: center;
					gap: 10px;
				}

				.see-all-btn:hover {
					transform: translateY(-2px);
					box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
					color: white;
					text-decoration: none;
				}

				/* Books Grid */
				.books-grid {
					display: grid;
					grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
					gap: 30px;
					padding: 0;
				}

				.book-card {
					background: white;
					border-radius: 15px;
					overflow: hidden;
					box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
					transition: all 0.3s ease;
					position: relative;
				}

				.book-card:hover {
					transform: translateY(-10px);
					box-shadow: 0 20px 40px rgba(0, 0, 0, 0.15);
				}

				.book-image-wrapper {
					position: relative;
					overflow: hidden;
				}

				.coverpage {
					position: relative;
				}

				.book-cover {
					width: 100%;
					height: 300px;
					object-fit: cover;
					transition: all 0.3s ease;
				}

				.book-card:hover .book-cover {
					transform: scale(1.05);
				}

				.book-overlay {
					position: absolute;
					top: 0;
					left: 0;
					right: 0;
					bottom: 0;
					background: rgba(0, 0, 0, 0.7);
					display: flex;
					align-items: center;
					justify-content: center;
					opacity: 0;
					transition: all 0.3s ease;
				}

				.book-card:hover .book-overlay {
					opacity: 1;
				}

				.quick-view-btn {
					background: #ffc107;
					color: white;
					padding: 12px 20px;
					border-radius: 25px;
					text-decoration: none;
					font-weight: 500;
					transition: all 0.3s ease;
				}

				.quick-view-btn:hover {
					background: #ff9800;
					color: white;
					text-decoration: none;
					transform: scale(1.05);
				}

				.book-info {
					padding: 20px;
				}

				.book-title {
					font-size: 1.2rem;
					font-weight: 600;
					color: #2c3e50;
					text-decoration: none;
					display: block;
					margin-bottom: 8px;
					line-height: 1.4;
				}

				.book-title:hover {
					color: #667eea;
					text-decoration: none;
				}

				.book-author {
					color: #6c757d;
					text-decoration: none;
					font-size: 0.95rem;
					display: block;
					margin-bottom: 12px;
				}

				.book-author:hover {
					color: #495057;
					text-decoration: none;
				}

				.rating-wrapper {
					display: flex;
					align-items: center;
					gap: 10px;
					margin-bottom: 15px;
				}

				.rating {
					color: #ffc107;
					font-size: 1rem;
				}

				.review-count {
					color: #6c757d;
					font-size: 0.9rem;
				}

				.price-wrapper {
					margin-bottom: 20px;
				}

				.price {
					font-size: 1.5rem;
					font-weight: 700;
					color: #28a745;
				}

				.add-to-cart-btn {
					background: linear-gradient(45deg, #28a745, #20c997);
					color: white;
					border: none;
					padding: 12px 20px;
					border-radius: 25px;
					font-weight: 500;
					transition: all 0.3s ease;
					width: 100%;
					display: flex;
					align-items: center;
					justify-content: center;
					gap: 10px;
				}

				.add-to-cart-btn:hover {
					background: linear-gradient(45deg, #218838, #1e8e6e);
					transform: translateY(-2px);
					box-shadow: 0 8px 20px rgba(40, 167, 69, 0.4);
					color: white;
				}

				/* Bestseller Badge */
				.bestseller {
					position: relative;
				}

				.bestseller-badge {
					position: absolute;
					top: 15px;
					right: 15px;
					background: linear-gradient(45deg, #dc3545, #c82333);
					color: white;
					padding: 5px 12px;
					border-radius: 15px;
					font-size: 0.8rem;
					font-weight: 600;
					z-index: 2;
					box-shadow: 0 4px 10px rgba(220, 53, 69, 0.3);
				}

				/* Responsive Design */
				@media (max-width: 768px) {
					.books-grid {
						grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
						gap: 20px;
					}

					.slide-title {
						font-size: 2rem;
					}

					.section-title {
						font-size: 2.2rem;
						font-weight: 800;
					}

					.section-title::before {
						width: 4px;
						height: 50px;
						left: -15px;
					}

					.title-icon {
						font-size: 2rem;
					}

					.modern-section-header {
						flex-direction: column;
						gap: 20px;
						align-items: flex-start;
					}
				}

				@media (max-width: 576px) {
					.books-grid {
						grid-template-columns: 1fr;
					}

					.slide-title {
						font-size: 1.5rem;
					}

					.section-title {
						font-size: 1.8rem;
						font-weight: 800;
					}

					.section-title::before {
						width: 3px;
						height: 40px;
						left: -10px;
					}

					.title-icon {
						font-size: 1.5rem;
					}
				}
			</style>

			<script>
				// Enhanced add to cart functionality
				document.addEventListener('DOMContentLoaded', function() {
					const addToCartButtons = document.querySelectorAll('.add-to-cart-btn');
					
					addToCartButtons.forEach(button => {
						button.addEventListener('click', function(e) {
							e.preventDefault();
							const bookId = this.getAttribute('data-book-id');
							const originalText = this.innerHTML;
							
							// Add loading state
							this.innerHTML = '<i class="fa fa-spinner fa-spin"></i> Adding...';
							this.disabled = true;
							this.style.background = 'linear-gradient(45deg, #6c757d, #5a6268)';
							
							// AJAX call to add book to cart
							fetch(`/cart/add/${bookId}`, {
								method: 'GET',
								headers: {
									'X-Requested-With': 'XMLHttpRequest',
								},
							})
							.then(response => {
								if (response.ok) {
									// Success state
									this.innerHTML = '<i class="fa fa-check"></i> Added to Cart!';
									this.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
									
									// Show success message
									showSnackbar('Book added to cart successfully!', 'success');
									
									// Update cart counter if exists
									updateCartCounter();
									
									// Reset button after 3 seconds
									setTimeout(() => {
										this.innerHTML = originalText;
										this.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
										this.disabled = false;
									}, 3000);
								} else {
									throw new Error('Failed to add to cart');
								}
							})
							.catch(error => {
								console.error('Error:', error);
								// Error state
								this.innerHTML = '<i class="fa fa-exclamation-triangle"></i> Error';
								this.style.background = 'linear-gradient(45deg, #dc3545, #c82333)';
								
								// Show error message
								showSnackbar('Failed to add book to cart. Please try again.', 'error');
								
								// Reset button after 3 seconds
								setTimeout(() => {
									this.innerHTML = originalText;
									this.style.background = 'linear-gradient(45deg, #28a745, #20c997)';
									this.disabled = false;
								}, 3000);
							});
						});
					});
				});

				// Function to update cart counter in header/navigation
				function updateCartCounter() {
					fetch('/cart/totalcart', {
						method: 'GET',
						headers: {
							'X-Requested-With': 'XMLHttpRequest',
						},
					})
					.then(response => response.text())
					.then(data => {
						// Update cart counter elements
						const cartCount = data.trim();
						const cartBadges = document.querySelectorAll('#gettotalcart, #mobileCartCount, .cart-counter');
						
						cartBadges.forEach(badge => {
							if (badge) {
								badge.textContent = cartCount;
								badge.classList.add('cart-updated');
								
								// Add pulse animation
								badge.style.animation = 'cartPulse 0.6s ease-out';
								
								setTimeout(() => {
									badge.classList.remove('cart-updated');
									badge.style.animation = '';
								}, 600);
							}
						});
						
						// Call the header's updateCartCount function if it exists
						if (typeof updateCartCount === 'function') {
							updateCartCount(cartCount);
						}
					})
					.catch(error => {
						console.error('Error updating cart counter:', error);
					});
				}

				function showSnackbar(message, type = 'success') {
					// Remove existing snackbar if any
					const existingSnackbar = document.querySelector('.custom-snackbar');
					if (existingSnackbar) {
						existingSnackbar.remove();
					}

					// Create snackbar element
					const snackbar = document.createElement('div');
					snackbar.className = `custom-snackbar snackbar-${type}`;
					snackbar.innerHTML = `
						<div class="snackbar-content">
							<i class="fa fa-${type === 'success' ? 'check-circle' : 'exclamation-triangle'}"></i>
							<span>${message}</span>
						</div>
					`;
					
					// Style the snackbar
					snackbar.style.cssText = `
						position: fixed;
						bottom: 30px;
						right: 30px;
						background: ${type === 'success' ? 'linear-gradient(45deg, #28a745, #20c997)' : 'linear-gradient(45deg, #dc3545, #c82333)'};
						color: white;
						padding: 15px 25px;
						border-radius: 50px;
						box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
						z-index: 9999;
						font-weight: 500;
						transform: translateY(100px);
						opacity: 0;
						transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
						max-width: 400px;
						backdrop-filter: blur(10px);
					`;

					// Add to page
					document.body.appendChild(snackbar);
					
					// Animate in
					setTimeout(() => {
						snackbar.style.transform = 'translateY(0)';
						snackbar.style.opacity = '1';
					}, 100);
					
					// Auto remove after 4 seconds
					setTimeout(() => {
						snackbar.style.transform = 'translateY(100px)';
						snackbar.style.opacity = '0';
						setTimeout(() => {
							if (snackbar.parentNode) {
								snackbar.remove();
							}
						}, 300);
					}, 4000);
				}

				// Add cart counter animation styles
				const style = document.createElement('style');
				style.textContent = `
					.cart-counter {
						transition: all 0.3s ease;
					}
					
					.cart-counter.cart-updated {
						background: #ffc107 !important;
						transform: scale(1.2);
						animation: cartPulse 0.6s ease-out;
					}
					
					@keyframes cartPulse {
						0% { transform: scale(1); }
						50% { transform: scale(1.3); }
						100% { transform: scale(1.2); }
					}
					
					.snackbar-content {
						display: flex;
						align-items: center;
						gap: 12px;
					}
					
					.snackbar-content i {
						font-size: 18px;
					}
				`;
				document.head.appendChild(style);
			</script>
			{% endblock %}
